<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔍 Refill AI Analytics Test</title>
    
    <!-- Plausible Analytics -->
    <script defer data-domain="refillai.online" src="https://plausible.io/js/script.file-downloads.hash.outbound-links.pageview-props.revenue.tagged-events.js"></script>
    
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f8fafc;
            color: #1e293b;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .test-section { 
            margin: 25px 0; 
            padding: 25px; 
            background: white;
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        .test-section h3 {
            margin-top: 0;
            color: #334155;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }
        button { 
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 8px; 
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        .status { 
            margin: 15px 0; 
            padding: 15px; 
            border-radius: 8px; 
            font-weight: 600;
        }
        .success { 
            background: #dcfce7; 
            color: #166534; 
            border: 1px solid #bbf7d0;
        }
        .warning { 
            background: #fef3c7; 
            color: #92400e; 
            border: 1px solid #fde68a;
        }
        .error {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        #console-output { 
            background: #0f172a; 
            color: #10b981; 
            padding: 20px; 
            border-radius: 8px; 
            font-family: 'Monaco', 'Menlo', monospace; 
            height: 300px; 
            overflow-y: auto; 
            margin-top: 20px;
            border: 1px solid #334155;
            font-size: 13px;
            line-height: 1.5;
        }
        .link-section a {
            color: #3b82f6;
            text-decoration: none;
            margin: 0 15px;
            padding: 8px 16px;
            border: 1px solid #3b82f6;
            border-radius: 6px;
            transition: all 0.2s;
        }
        .link-section a:hover {
            background: #3b82f6;
            color: white;
        }
        .download-section a {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            margin: 5px;
            transition: all 0.2s;
        }
        .download-section a:hover {
            background: #059669;
            transform: translateY(-1px);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #3b82f6;
        }
        .stat-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔍 Refill AI Analytics Test Dashboard</h1>
        <p>Professional Plausible Analytics Integration Testing</p>
    </div>
    
    <div id="plausible-status" class="status warning">
        ⏳ Checking Plausible Analytics status...
    </div>
    
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number" id="events-sent">0</div>
            <div class="stat-label">Events Sent</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="page-views">0</div>
            <div class="stat-label">Page Views</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="errors-tracked">0</div>
            <div class="stat-label">Errors Tracked</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="session-time">0s</div>
            <div class="stat-label">Session Time</div>
        </div>
    </div>
    
    <div class="test-section">
        <h3>📊 Core Analytics Tests</h3>
        <button onclick="testPageView()">📄 Test Page View</button>
        <button onclick="testImageGeneration()">🎨 Test Image Generation</button>
        <button onclick="testImageDownload()">⬇️ Test Image Download</button>
        <button onclick="testImageShare()">📤 Test Image Share</button>
        <button onclick="testImageAnalysis()">🔍 Test Image Analysis</button>
    </div>
    
    <div class="test-section">
        <h3>🎯 User Interaction Tests</h3>
        <button onclick="testLanguageChange()">🌍 Test Language Change</button>
        <button onclick="testFeatureUsage()">⚡ Test Feature Usage</button>
        <button onclick="testSearch()">🔎 Test Search</button>
        <button onclick="testHistoryAction()">📚 Test History Action</button>
        <button onclick="testTabSwitch()">🔄 Test Tab Switch</button>
    </div>
    
    <div class="test-section">
        <h3>🚨 Error & Performance Tests</h3>
        <button onclick="testError()">❌ Test Error Tracking</button>
        <button onclick="testEngagement()">💡 Test User Engagement</button>
        <button onclick="testFormSubmission()">📝 Test Form Submission</button>
        <button onclick="triggerJSError()">💥 Trigger JS Error</button>
    </div>
    
    <div class="test-section">
        <h3>🔗 External Links Test (Outbound Tracking)</h3>
        <div class="link-section">
            <a href="https://plausible.io" target="_blank">Visit Plausible.io</a>
            <a href="https://github.com" target="_blank">Visit GitHub</a>
            <a href="https://vercel.com" target="_blank">Visit Vercel</a>
        </div>
    </div>
    
    <div class="test-section">
        <h3>📁 File Downloads Test</h3>
        <div class="download-section">
            <a href="data:text/plain;charset=utf-8,Test file content for analytics" download="analytics-test.txt">📄 Download Test TXT</a>
            <a href="data:application/json;charset=utf-8,{\"test\": \"analytics\"}" download="analytics-test.json">📋 Download Test JSON</a>
            <a href="data:text/csv;charset=utf-8,name,value\ntest,analytics" download="analytics-test.csv">📊 Download Test CSV</a>
        </div>
    </div>
    
    <div class="test-section">
        <h3>🧪 Batch Test</h3>
        <button onclick="runBatchTest()">🚀 Run All Tests</button>
        <button onclick="clearConsole()">🧹 Clear Console</button>
        <button onclick="exportLogs()">💾 Export Logs</button>
    </div>
    
    <div id="console-output"></div>

    <script>
        // Analytics tracking variables
        let eventsSent = 0;
        let pageViews = 0;
        let errorsTracked = 0;
        let sessionStartTime = Date.now();

        // Update stats display
        function updateStats() {
            document.getElementById('events-sent').textContent = eventsSent;
            document.getElementById('page-views').textContent = pageViews;
            document.getElementById('errors-tracked').textContent = errorsTracked;
            document.getElementById('session-time').textContent = Math.round((Date.now() - sessionStartTime) / 1000) + 's';
        }

        // Console logging function
        function logToConsole(message, type = 'info') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const emoji = type === 'error' ? '❌' : type === 'success' ? '✅' : type === 'warning' ? '⚠️' : '📝';
            output.innerHTML += `<div style="margin: 2px 0;"><span style="color: #64748b;">[${timestamp}]</span> ${emoji} ${message}</div>`;
            output.scrollTop = output.scrollHeight;
            
            if (type !== 'error') eventsSent++;
            updateStats();
        }

        // Plausible tracking function
        function trackEvent(eventName, props = {}) {
            if (typeof window.plausible !== 'undefined') {
                window.plausible(eventName, { props });
                logToConsole(`Event tracked: ${eventName}`, 'success');
                return true;
            } else {
                logToConsole(`Event would be tracked: ${eventName} (Plausible not loaded)`, 'warning');
                return false;
            }
        }

        // Check Plausible status
        function checkPlausibleStatus() {
            const statusDiv = document.getElementById('plausible-status');
            
            setTimeout(() => {
                if (typeof window.plausible !== 'undefined') {
                    statusDiv.className = 'status success';
                    statusDiv.innerHTML = '✅ Plausible Analytics loaded successfully! Ready for testing.';
                    logToConsole('Plausible Analytics loaded successfully', 'success');
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.innerHTML = '❌ Plausible Analytics failed to load. Check your script tag and domain configuration.';
                    logToConsole('Plausible Analytics not loaded', 'error');
                }
            }, 1500);
        }

        // Test functions
        function testPageView() {
            trackEvent('Page View', { 
                page: 'analytics-test',
                test: 'true',
                timestamp: new Date().toISOString()
            });
            pageViews++;
        }

        function testImageGeneration() {
            trackEvent('Image Generated', {
                style: 'realistic',
                quality: 'standard',
                aspect_ratio: '1:1',
                prompt_length: '25',
                test: 'true'
            });
        }

        function testImageDownload() {
            trackEvent('Image Downloaded', {
                source: 'single',
                image_index: '1',
                test: 'true'
            });
        }

        function testImageShare() {
            trackEvent('Image Shared', {
                method: 'native',
                success: 'true',
                test: 'true'
            });
        }

        function testImageAnalysis() {
            trackEvent('Image Analyzed', {
                file_size: '1024',
                file_type: 'image/jpeg',
                test: 'true'
            });
        }

        function testLanguageChange() {
            trackEvent('Language Changed', {
                from_language: 'en',
                to_language: 'zh',
                test: 'true'
            });
        }

        function testFeatureUsage() {
            trackEvent('Feature Used', {
                feature: 'Analytics Test',
                action: 'clicked',
                test: 'true'
            });
        }

        function testSearch() {
            trackEvent('Search Performed', {
                query_length: '10',
                results_count: '5',
                test: 'true'
            });
        }

        function testHistoryAction() {
            trackEvent('History Action', {
                action: 'view',
                details: 'test',
                test: 'true'
            });
        }

        function testTabSwitch() {
            trackEvent('Tab Switch', {
                from_tab: 'generate',
                to_tab: 'analyze',
                test: 'true'
            });
        }

        function testError() {
            trackEvent('Error Occurred', {
                error_type: 'Test Error',
                context: 'analytics-test',
                test: 'true'
            });
            errorsTracked++;
        }

        function testEngagement() {
            trackEvent('User Engagement', {
                action: 'test_interaction',
                value: '1',
                test: 'true'
            });
        }

        function testFormSubmission() {
            trackEvent('Form Submission', {
                form_type: 'test',
                success: 'true',
                test: 'true'
            });
        }

        function triggerJSError() {
            try {
                // Intentionally trigger an error
                nonExistentFunction();
            } catch (error) {
                logToConsole(`JavaScript Error triggered: ${error.message}`, 'error');
                trackEvent('JavaScript Error', {
                    message: error.message,
                    test: 'true'
                });
                errorsTracked++;
            }
        }

        function runBatchTest() {
            logToConsole('🚀 Starting batch test...', 'info');
            
            const tests = [
                testPageView,
                testImageGeneration,
                testImageDownload,
                testImageShare,
                testImageAnalysis,
                testLanguageChange,
                testFeatureUsage,
                testSearch,
                testHistoryAction,
                testTabSwitch,
                testError,
                testEngagement,
                testFormSubmission
            ];

            tests.forEach((test, index) => {
                setTimeout(() => {
                    test();
                    if (index === tests.length - 1) {
                        logToConsole('✅ Batch test completed!', 'success');
                    }
                }, index * 200);
            });
        }

        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
            logToConsole('Console cleared', 'info');
        }

        function exportLogs() {
            const logs = document.getElementById('console-output').innerText;
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `analytics-logs-${new Date().toISOString().slice(0, 19)}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            logToConsole('Logs exported', 'success');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            logToConsole('🚀 Analytics test page loaded', 'info');
            checkPlausibleStatus();
            
            // Update stats every second
            setInterval(updateStats, 1000);
            
            // Track page view automatically
            setTimeout(() => {
                testPageView();
            }, 2000);
        });

        // Track page unload
        window.addEventListener('beforeunload', function() {
            trackEvent('Page Unload', {
                session_duration: Math.round((Date.now() - sessionStartTime) / 1000),
                events_sent: eventsSent,
                test: 'true'
            });
        });

        // Override console.log to capture in our display
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToConsole(args.join(' '), 'info');
        };

        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            logToConsole(args.join(' '), 'error');
            errorsTracked++;
        };
    </script>
</body>
</html> 